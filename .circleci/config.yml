# version: 2
# jobs:
#   build:
#     machine: true
#     steps:
#       - run:
#           command: |
#             sudo pip install pipenv
#             pipenv install
#             pipenv shell
#             cd backend
#             pipenv run "python manage.py test"

version: 2 # use CircleCI 2.0
jobs: # A basic unit of work in a run
  build: 
    working_directory: ~/timelapsed
    docker:
      - image: circleci/python:3.6.4
        environment:
          PIPENV_VENV_IN_PROJECT: true
          DATABASE_URL: postgresql://root@localhost/circle_test?sslmode=disable
      - image: circleci/postgres:9.6.2
        environment:
          POSTGRES_USER: root
          POSTGRES_DB: circle_test
    steps: # steps that comprise the `build` job
      - checkout
      - run:
          command: |
            sudo pip install pipenv
            pipenv install
            cd backend
            pipenv run python manage.py test